var ssoBaseUrl="https://passport.ingping.com";function login(){var fx_flag=getFxFlag();if(fx_flag){return location.href=ssoBaseUrl+"/login/index?retUrl="+encodeURIComponent(appUrl)+"&fxPid="+fx_flag;}else{return location.href=ssoBaseUrl+"/login/index?retUrl="+encodeURIComponent(appUrl);}}
function register(){var fx_flag=getFxFlag();if(fx_flag){return location.href=ssoBaseUrl+"/reg/index?retUrl="+encodeURIComponent(appUrl)+"&fxPid="+fx_flag;}else{return location.href=ssoBaseUrl+"/reg/index?retUrl="+encodeURIComponent(appUrl);}}
function mlogin(qLogin){var fx_flag=getFxFlag();if(qLogin&&qLogin==true){if(fx_flag){return location.href=ssoBaseUrl+"/login/index?stype=m&qLogin=yes&retUrl="+encodeURIComponent(appUrl)+"&fxPid="+fx_flag;}else{return location.href=ssoBaseUrl+"/login/index?stype=m&qLogin=yes&retUrl="+encodeURIComponent(appUrl);}}else{if(fx_flag){return location.href=ssoBaseUrl+"/login/index?stype=m&retUrl="+encodeURIComponent(appUrl)+"&fxPid="+fx_flag;}else{return location.href=ssoBaseUrl+"/login/index?stype=m&retUrl="+encodeURIComponent(appUrl);}}}
function mregister(){var fx_flag=getFxFlag();if(fx_flag){return location.href=ssoBaseUrl+"/reg/index?stype=m&retUrl="+encodeURIComponent(appUrl)+"&fxPid="+fx_flag;}else{return location.href=ssoBaseUrl+"/reg/index?stype=m&retUrl="+encodeURIComponent(appUrl);}}
function helloVerify(){$.getJSON(ssoBaseUrl+"/hello/verify?t="+new Date().getTime()+"&callback=?",function(data){if(data.token){if($.isFunction(window.showUserInfo)){showUserInfo(data);}
delCurrentDomainCookie("user_token");delRootDomainCookie("user_token");delCurrentDomainCookie("user_identity");delRootDomainCookie("user_identity");saveCookieSSO("user_token",data.token,0,"/");saveCookieSSO("user_identity",data.identity,0,"/");}else{var oldIdentity=getCookie("user_identity");if($.isFunction(window.hideUserInfo)){hideUserInfo();}
delCurrentDomainCookie("user_token");delRootDomainCookie("user_token");delCurrentDomainCookie("user_identity");delRootDomainCookie("user_identity");saveCookieSSO("user_identity",data.identity,7*24,"/");if(oldIdentity&&data.identity&&!isNaN(oldIdentity)&&isNaN(data.identity)){location.reload();}}});}
function delRootDomainCookie(cookieName){delCookieSSO(cookieName,getRootDomain(),"/");delCookieSSO(cookieName,getRootDomain(),getUrlRelativePath());delCookieSSO(cookieName,'.'+getRootDomain(),"/");delCookieSSO(cookieName,'.'+getRootDomain(),getUrlRelativePath());}
function delCurrentDomainCookie(cookieName){delCookieSSO(cookieName,"","/");delCookieSSO(cookieName,"",getUrlRelativePath());delCookieSSO(cookieName,'.'+getCurrentDomain(),"/");delCookieSSO(cookieName,'.'+getCurrentDomain(),getUrlRelativePath());}
function getUrlRelativePath(){var path="/";var url=document.location.toString();var arrUrl=url.split("//");var start=arrUrl[1].indexOf("/");var relUrl=arrUrl[1].substring(start);if(relUrl.indexOf("?")!=-1){relUrl=relUrl.split("?")[0];}
var lastIndex=relUrl.lastIndexOf("/");if(lastIndex){path=relUrl.substr(0,lastIndex);}
return path;}
function getRootDomain(){var hostname=location.hostname
if(hostname.split('.').length>2){var start=hostname.indexOf('.');hostname=hostname.substr(start+1,hostname.length);}
return hostname;}
function getCurrentDomain(){var hostname=location.hostname
return hostname;}
$(function(){helloVerify();$("#quickloginsubmit").click(function(){$("#quickloginErrorDiv").hide();var verifyEncryptCode=$("#quicklverifyEncryptCode").val();if(verifyEncryptCode){$(this).attr("disabled","disabled").val("登录中..");$.ajax({type:"POST",url:ssoBaseUrl+"/login/loginSave",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:$("#formquicklogin").serialize(),error:function(){alert("网络超时，请稍后再试");$(this).removeAttr("disabled").val("立即登录");},success:function(result){if(result){var obj=eval(result);if(obj.success){if(typeof(noRediret)=="undefined")
{var isIE=!-[1,];if(isIE){var link=document.createElement("a");link.href=obj.success+location.hash;link.style.display='none';document.body.appendChild(link);link.click();}else{var location_href=obj.success+location.hash;if(location_href.indexOf("yshifu")!=-1&&typeof(indexUrl)!="undefined"){window.parent.location=indexUrl+"/shifu/me";}else{window.parent.location=location_href;}}}else{helloVerify();}}else{$("#quickloginsubmit").removeAttr("disabled").val("立即登录");}
if(obj.nouuid){$("#quickloginErrorDiv").show().find(".quickloginError").text(obj.nouuid);}
if(obj.userName){$("#quickloginErrorDiv").show().find(".quickloginError").text(obj.userName);}
if(obj.pwd){$("#quickloginErrorDiv").show().find(".quickloginError").text(obj.pwd);}
if(obj.emptyAuthcode){$("#quickloginErrorDiv").show().find(".quickloginError").text(obj.emptyAuthcode);}}else{$("#quickloginsubmit").removeAttr("disabled").val("立即登录");}}});}});$("#loginsubmit").click(function(){$("#loginErrorDiv").hide();var verifyEncryptCode=$("#verifyEncryptCode").val();if(verifyEncryptCode){$(this).attr("disabled","disabled").val("登录中..");var userNameE=$("#userName");var ltype=$("#ltype");if(ltype.length>0&&ltype!="mini"){if(userNameE.length>0){userNameE.removeClass("f-bord");}
var rememberMeE=$('#rememberMe');if(rememberMeE.length>0&&rememberMeE.is(":checked")){saveCookieSSO("user_name",userNameE.val(),7*24,"/");}}
$.ajax({type:"POST",url:ssoBaseUrl+"/login/loginSave",contentType:"application/x-www-form-urlencoded; charset=utf-8",data:$("#formlogin").serialize(),error:function(){alert("网络超时，请稍后再试");$(this).removeAttr("disabled").val("立即登录");},success:function(result){if(result){var obj=eval(result);if(obj.success){var isIE=!-[1,];if(isIE){var link=document.createElement("a");link.href=obj.success+location.hash;link.style.display='none';document.body.appendChild(link);link.click();}else{var location_href=obj.success+location.hash;if(location_href.indexOf("yshifu")!=-1&&typeof(indexUrl)!="undefined"){window.parent.location=indexUrl+"/shifu/me";}else{var noRediret=$("#noRediret").val();if(noRediret=="yes"){window.location=obj.iFrameTransferUrl;}
window.parent.location=location_href;}}}else{$("#loginsubmit").removeAttr("disabled").val("立即登录");}
if(obj.nouuid){$("#loginErrorDiv").show().find(".loginError").text(obj.nouuid);}
if(obj.userName){if(ltype.length>0&&ltype!="mini"){if(userNameE){userNameE.addClass("f-bord");}}
$("#loginErrorDiv").show().find(".loginError").text(obj.userName);}
if(obj.pwd){$("#loginErrorDiv").show().find(".loginError").text(obj.pwd);}
if(obj.emptyAuthcode){$("#loginErrorDiv").show().find(".loginError").text(obj.emptyAuthcode);}}else{$("#loginsubmit").removeAttr("disabled").val("立即登录");}}});}});$("#regsubmit").click(function(){$("#userNameErrorDiv").hide();$(this).attr("disabled","disabled").val("注册中...");if($("#agree").get(0).checked){var cheackFlag=checkUserName('reg');if(cheackFlag){cheackFlag=checkPassword('password')&&checkConfirmPassword('password','confirmPassword');}
if(cheackFlag){$.ajax({type:"POST",url:ssoBaseUrl+"/reg/regSave?r="+new Date().getTime()+"&"+location.search.substring(1),contentType:"application/x-www-form-urlencoded; charset=utf-8",data:$("#formreg").serialize(),error:function(){alert("网络超时，请稍后再试");$(this).removeAttr("disabled").val("立即注册");},success:function(result){if(result){var obj=eval(result);if(obj.success){var isIE=!-[1,];if(isIE){var link=document.createElement("a");link.href=obj.success+location.hash;link.style.display='none';document.body.appendChild(link);link.click();}else{window.location=obj.success+location.hash;}}else{$("#regsubmit").removeAttr("disabled").val("立即注册");}
if(obj.failure){alert(obj.failure);}
if(obj.nouuid){alert(obj.nouuid);}
if(obj.userName){$("#userNameErrorDiv").show().find(".userNameError").text(obj.userName);}
if(obj.userNameAndPsd){alert(obj.userNameAndPsd);}
if(obj.emptyAuthcode){alert(obj.emptyAuthcode);}}else{$("#regsubmit").removeAttr("disabled").val("立即注册");}}});}else{alert("注册失败，请重新注册");$("#regsubmit").removeAttr("disabled").val("立即注册");}}else{alert("您还未阅读并同意《音平网服务协议》哦");$("#regsubmit").removeAttr("disabled").val("立即注册");}});$("#phoneRegSubmit").click(function(){$(this).attr("disabled","disabled").val("注册中...");if($("#phoneAgree").get(0).checked){var checkFlag=checkPhone('phoneNum');if(checkFlag){checkFlag=checkAuthCode('authCode')&&checkPassword('phonePassword');}
if(checkFlag){$.ajax({type:"POST",url:ssoBaseUrl+"/reg/phoneRegSave?r="+new Date().getTime()+"&"+location.search.substring(1),contentType:"application/x-www-form-urlencoded; charset=utf-8",data:$("#phoneFormReg").serialize(),error:function(){alert("网络超时，请稍后再试");$("#phoneRegSubmit").removeAttr("disabled").val("立即注册");},success:function(result){if(result){var obj=eval(result);if(obj.success){var isIE=!-[1,];if(isIE){var link=document.createElement("a");link.href=obj.success+location.hash;link.style.display='none';document.body.appendChild(link);link.click();}else{window.location=obj.success+location.hash;}}else{$("#phoneRegSubmit").removeAttr("disabled").val("立即注册");}
if(obj.failure){alert(obj.failure);$("#phoneRegSubmit").removeAttr("disabled").val("立即注册");}
if(obj.nouuid){alert(obj.nouuid);$("#phoneRegSubmit").removeAttr("disabled").val("立即注册");}}else{$("#phoneRegSubmit").removeAttr("disabled").val("立即注册");}}});}else{$(this).removeAttr("disabled").val("立即注册");}}else{alert("您还未阅读并同意《音平网服务协议》哦");$(this).removeAttr("disabled").val("立即注册");}});});function checkUserName(type){var result=false;var userName=$("#userName").val();var ltype=$("#ltype");if(ltype.length>0&&ltype!="mini"){userName=$("#userNameOrEmail").val();}
if(userName){var checkFlag=false;if(type=="login"){checkFlag=isUserName(userName);if(checkFlag)$("#loginErrorDiv").hide().find(".loginError").text("");}else if(type=="reg"){checkFlag=isEmail(userName);if(checkFlag)$("#userNameErrorDiv").hide().find(".userNameError").text("");}
if(checkFlag){var verifyEncryptCode=$("#phoneVerifyEncryptCode").val();$.ajax({type:"Get",url:ssoBaseUrl+"/users/validateUserName",async:false,data:'userName='+userName+"&verifyEncryptCode="+verifyEncryptCode+"&t="+new Date().getTime(),success:function(data){if(type=="login"){if(data.result){$("#loginErrorDiv").show().find(".loginError").text("该账号不存在,请输入其它账号！");}else{result=true;}}else if(type=="reg"){if(data.result){result=true;}else{$("#userNameErrorDiv").show().find(".userNameError").text("该账号已存在,请输入其它账号！");}}}});}else{if(type=="login"){$("#loginErrorDiv").show().find(".loginError").text("账号应为邮箱/用户名/手机号，请重新输入！");}else if(type=="reg"){$("#userNameErrorDiv").show().find(".userNameError").text("账号应为邮箱地址，请重新输入！");}}}else{if(type=="login"){$("#loginErrorDiv").show().find(".loginError").text("请填写您的账号！");}else if(type=="reg"){$("#userNameErrorDiv").show().find(".userNameError").text("请填写您的账号！");}}
return result;}
function checkPassword(domId){var result=false;var password=$("#"+domId).val();var errorDiv=$("#"+domId+"ErrorDiv");var errorTextDom=$("#"+domId+"Error");if(password&&isPassWord(password,6,20)){errorTextDom.text("");errorDiv.hide();result=true;}else{errorTextDom.text("由字母加数字组成的6-20位半角字符，区分大小写");errorDiv.show();}
return result;}
function checkPhone(domId){var result=false;var phoneNum=$("#"+domId).val();var errorDiv=$("#"+domId+"ErrorDiv");var errorTextDom=$("#"+domId+"Error");if(isPhone(phoneNum)){var verifyEncryptCode=$("#phoneVerifyEncryptCode").val();$.ajax({type:"Get",url:ssoBaseUrl+"/users/validateUserName",async:false,data:'userName='+phoneNum+"&verifyEncryptCode="+verifyEncryptCode+"&t="+new Date().getTime(),success:function(data){if(data.result){errorTextDom.text("");errorDiv.hide();result=true;}else{errorTextDom.text("该手机号已注册或被绑定,请输入其它手机号！");errorDiv.show();}}});}else{errorTextDom.text("请输入正确的手机号码");errorDiv.show();}
return result}
function checkPhoneNumber(domId,callback){var result=false;var phoneNum=$("#"+domId).val();if(isPhone(phoneNum)){var verifyEncryptCode=$("#phoneVerifyEncryptCode").val();$.ajax({type:"Get",url:ssoBaseUrl+"/users/validateUserName",async:false,data:'userName='+phoneNum+"&verifyEncryptCode="+verifyEncryptCode+"&t="+new Date().getTime(),success:function(data){typeof callback!='undefined'&&(result=callback(domId,data));}});}else{errorTextDom.text("请输入正确的手机号码");errorDiv.show();}
return result}
function checkAuthCode(domId){var result=false;var authCode=$("#"+domId).val();var errorDiv=$("#"+domId+"ErrorDiv");var errorTextDom=$("#"+domId+"Error");if(isAuthCode(authCode)){errorTextDom.text("");errorDiv.hide();result=true;}else{errorTextDom.text("请输入手机收到的验证码");errorDiv.show();}
return result}
function checkConfirmPassword(pwdDom,cPwdDom){var result=false;var password=$("#"+pwdDom).val();var confirmPassword=$("#"+cPwdDom).val();var cPwdErrorDiv=$("#"+cPwdDom+"ErrorDiv");var cPwdErrorTextDom=$("#"+cPwdDom+"Error");if(confirmPassword&&isPassWord(confirmPassword,6,20)){cPwdErrorTextDom.text("");cPwdErrorDiv.hide();result=true;}else{cPwdErrorTextDom.text("由字母加数字组成的6-20位半角字符，区分大小写");cPwdErrorDiv.show();}
if(password!=confirmPassword){cPwdErrorTextDom.text("两次输入密码不一致，请重新输入！");cPwdErrorDiv.show();}
return result;}
function encryptVerifyCode(verifyCode){var encryptVerifyCode="";if(verifyCode){var sc_f10=verifyCode.substr(0,10);var sc_e8=verifyCode.substr(10);var sc_f10Arr=sc_f10.split("");var sc_e8Arr=sc_e8.split("");for(var i=0;i<8;i++){encryptVerifyCode+=sc_f10Arr[(sc_e8Arr[i])];}}
return encryptVerifyCode;}
function isEmail(str){var reg=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;return reg.test(str);}
function isUserName(str){return isEmail(str)||isPhone(str);}
function isPassWord(value,min,max){var str="/^(?![0-9]+$)(?![a-zA-Z]+$)[0-9A-Za-z]"+"{"+min+","+max+"}$/";var regExp=eval(str);var reg=new RegExp(regExp);return reg.test(value);}
function isPhone(str){var reg=/^(1[3-9])\d{9}$/;return reg.test(str);}
function isAuthCode(str){var result=false;if(str){result=true;}
return result;}
function saveCookieSSO(name,value,expires,path){var domain="";var host=window.location.host;if(host.indexOf("ingping.com")!=-1){domain=".ingping.com";}else if(host.indexOf("ingping.cn")!=-1){domain=".ingping.cn";}else if(host.indexOf("ingping.net")!=-1){domain=".ingping.net";}
setCookie(name,value,expires,domain,path);}
function isNullStr(obj){return!(obj==''||obj==null)}
function setCookie(name,value,expires,domian,path){var str=name+"="+encodeURI(value);if(expires){if((!isNaN(expires))&&expires>0){var date=new Date();var ms=expires*3600*1000;date.setTime(date.getTime()+ms);str+=";expires="+date.toGMTString();}else{str+=";expires="+expires;}}
if((path!=undefined)&&(path!="")&&path!=null){str+=(";path="+path);}else{str+=(";path=/");}
if((domian!=undefined)&&(domian!="")&&domian!=null){str+=(";domain="+domian);}
document.cookie=str;}
function delCookieSSO(name,domian,path){setCookie(name,'','Thu, 01 Jan 1970 00:00:01 GMT',domian,path);}
function getCookie(name){var arrCookie=document.cookie.split(";");var value="";for(var i=0;i<arrCookie.length;i++){var arr=arrCookie[i].split("=");if(name==$.trim(arr[0])){value=$.trim(arr[1]);break;}}
value=decodeURI(value);return value;}
function isWeixin(){var ua=window.navigator.userAgent;if(ua){ua=ua.toLowerCase();if(ua.match(/MicroMessenger/i)==="micromessenger"){return true;}}
return false;}
$(function(){saveFxFlag('');});function saveFxFlag(fx_flag){if(fx_flag==''){var reg=new RegExp('(^|&)'+'parentId'+'=([^&]*)(&|$)');var val=window.location.search.substr(1).match(reg);if(val==null){reg=new RegExp('(^|&)'+'distSuperUnionID'+'=([^&]*)(&|$)');val=window.location.search.substr(1).match(reg);}
if(val!=null){fx_flag=unescape(val[2]);}}
if(fx_flag&&fx_flag!=''){window.localStorage.removeItem("fx_flag");window.localStorage.setItem("fx_flag",JSON.stringify({unionid:fx_flag,expireTime:Date.parse(new Date())+30*24*60*60*1000}));saveCookieSSO("fx_flag",fx_flag,30*24,"/");}}
function getFxFlag(){var fx_flag=JSON.parse(window.localStorage.getItem("fx_flag"));if(fx_flag&&parseFloat(fx_flag.expireTime)>=parseFloat(Date.parse(new Date()))){return fx_flag.unionid;}else{var fx_flag_inCookie=getCookie("fx_flag");if(fx_flag_inCookie){saveFxFlag(fx_flag_inCookie);return fx_flag_inCookie;}else{delFxFlag();}}
return null;}
function delFxFlag(){window.localStorage.removeItem("fx_flag");delCookieSSO("fx_flag");}